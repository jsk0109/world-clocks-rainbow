<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Clock Rainbow</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <ul>
            <li><a href="index.html">Time Base</a></li>
            <li><a href="about.html">My Story</a></li>
            <li><a href="privacy-policy.html">Guard Line</a></li>
            <li><a href="contact.html">Reach Out</a></li>
            <li><a href="guides.html">Help Zone</a></li>
            <li><a href="converter.html">Zone Shift</a></li>
            <li><a href="blog.html">Zone Stories</a></li>
        </ul>
    </nav>
    <div class="hero-section">
        <h1>World Clock Rainbow üåà</h1>
        <p>Check global times and weather at a glance! üïí A simple tool for meetings and travel, built by a newbie (me!) with Grok AI‚Äîand we‚Äôre teaming up with AI to keep adding more!</p>
    </div>
    <div id="filter-buttons"></div>
    <div id="clocks-container"></div>
    <div class="qna-section">
        <h2>Frequently Asked Questions</h2>
        <div class="accordion">
            <div class="accordion-header">How do I know the times are accurate?</div>
            <div class="accordion-content">
                <p>The times are based on your device‚Äôs clock and time zone offsets. Make sure your device‚Äôs time is correct for the best accuracy! üïí</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">Why isn‚Äôt the weather showing for some cities?</div>
            <div class="accordion-content">
                <p>We fetch weather from an external API. If it‚Äôs down or the city‚Äôs data isn‚Äôt available, you might see "N/A." We‚Äôll keep trying! üå¶Ô∏è</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">How can I use the clocks to plan my day across time zones?</div>
            <div class="accordion-content">
                <p>Select your desired cities on the homepage, and use the displayed times to schedule your activities, meetings, or calls. The weather info can also help you plan your day! üìÖ</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">How often does the weather update?</div>
            <div class="accordion-content">
                <p>Weather updates every 30 minutes to save on API calls. You‚Äôll always have fresh data without overloading the system! ‚òÄÔ∏è</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">Why do clocks overlap when I hover over them?</div>
            <div class="accordion-content">
                <p>Hovering zooms in for a better view, but clocks may overlap if they‚Äôre close. It‚Äôs a fun design choice to make things interactive! üñ±Ô∏è</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">Does this account for daylight saving time (DST)?</div>
            <div class="accordion-content">
                <p>Not yet‚Äîour clocks use standard offsets. Use the Time Zone Converter for DST adjustments! üåû</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">What should I do if the weather data isn‚Äôt loading?</div>
            <div class="accordion-content">
                <p>Try refreshing the page, as the issue might be due to a temporary API outage. If it persists, let us know via the Contact Us page, and we‚Äôll look into it! üåßÔ∏è</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">How do I use the Time Zone Converter?</div>
            <div class="accordion-content">
                <p>Go to the Converter page, pick your cities, and enter a time. We‚Äôll show you the matching times instantly! ‚è∞</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">Why are some flags missing?</div>
            <div class="accordion-content">
                <p>Flags come from an external service. If it‚Äôs down or a flag code is wrong, they might not show. Let us know if you spot an issue! üö©</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">Can I share the clock times with friends?</div>
            <div class="accordion-content">
                <p>There‚Äôs no direct share button yet, but you can screenshot the clocks and send them. We might add sharing soon! üì∏</p>
            </div>
        </div>
    </div>
    <div class="faq-section">
        <h2>FAQ</h2>
        <p><strong>How does this help?</strong> Sync your meetings or trips with global clocks and weather‚Äîeasy peasy!</p>
        <p><strong>Who made this?</strong> A computer newbie with 4-year-old English skills, powered by Grok AI!</p>
    </div>
    <script>
        const cities = [
            { name: "New York", lat: 40.7128, lon: -74.0060, offset: -4, flag: "us", continent: "North America" },
            { name: "London", lat: 51.5074, lon: -0.1278, offset: 1, flag: "gb", continent: "Europe" },
            { name: "Tokyo", lat: 35.6762, lon: 139.6503, offset: 9, flag: "jp", continent: "Asia" },
            { name: "Paris", lat: 48.8566, lon: 2.3522, offset: 2, flag: "fr", continent: "Europe" },
            { name: "Los Angeles", lat: 34.0522, lon: -118.2437, offset: -7, flag: "us", continent: "North America" },
            { name: "Sydney", lat: -33.8688, lon: 151.2093, offset: 10, flag: "au", continent: "Oceania" },
            { name: "Seoul", lat: 37.5665, lon: 126.9780, offset: 9, flag: "kr", continent: "Asia" },
            { name: "Berlin", lat: 52.5200, lon: 13.4050, offset: 2, flag: "de", continent: "Europe" },
            { name: "Toronto", lat: 43.6532, lon: -79.3832, offset: -4, flag: "ca", continent: "North America" },
            { name: "Moscow", lat: 55.7558, lon: 37.6173, offset: 3, flag: "ru", continent: "Europe" },
            { name: "Beijing", lat: 39.9042, lon: 116.4074, offset: 8, flag: "cn", continent: "Asia" },
            { name: "Dubai", lat: 25.2048, lon: 55.2708, offset: 4, flag: "ae", continent: "Asia" },
            { name: "Singapore", lat: 1.3521, lon: 103.8198, offset: 8, flag: "sg", continent: "Asia" },
            { name: "Hong Kong", lat: 22.3193, lon: 114.1694, offset: 8, flag: "hk", continent: "Asia" },
            { name: "Bangkok", lat: 13.7563, lon: 100.5018, offset: 7, flag: "th", continent: "Asia" },
            { name: "Mumbai", lat: 19.0760, lon: 72.8777, offset: 5.5, flag: "in", continent: "Asia" },
            { name: "Delhi", lat: 28.7041, lon: 77.1025, offset: 5.5, flag: "in", continent: "Asia" },
            { name: "Jakarta", lat: -6.2088, lon: 106.8456, offset: 7, flag: "id", continent: "Asia" },
            { name: "Manila", lat: 14.5995, lon: 120.9842, offset: 8, flag: "ph", continent: "Asia" },
            { name: "Kuala Lumpur", lat: 3.1390, lon: 101.6869, offset: 8, flag: "my", continent: "Asia" },
            { name: "Istanbul", lat: 41.0082, lon: 28.9784, offset: 3, flag: "tr", continent: "Europe" },
            { name: "Madrid", lat: 40.4168, lon: -3.7038, offset: 2, flag: "es", continent: "Europe" },
            { name: "Rome", lat: 41.9028, lon: 12.4964, offset: 2, flag: "it", continent: "Europe" },
            { name: "Amsterdam", lat: 52.3676, lon: 4.9041, offset: 2, flag: "nl", continent: "Europe" },
            { name: "Vienna", lat: 48.2082, lon: 16.3738, offset: 2, flag: "at", continent: "Europe" },
            { name: "Stockholm", lat: 59.3293, lon: 18.0686, offset: 2, flag: "se", continent: "Europe" },
            { name: "Oslo", lat: 59.9139, lon: 10.7522, offset: 2, flag: "no", continent: "Europe" },
            { name: "Helsinki", lat: 60.1699, lon: 24.9384, offset: 3, flag: "fi", continent: "Europe" },
            { name: "Copenhagen", lat: 55.6761, lon: 12.5683, offset: 2, flag: "dk", continent: "Europe" },
            { name: "Chicago", lat: 41.8781, lon: -87.6298, offset: -5, flag: "us", continent: "North America" },
            { name: "Miami", lat: 25.7617, lon: -80.1918, offset: -4, flag: "us", continent: "North America" },
            { name: "Vancouver", lat: 49.2827, lon: -123.1207, offset: -7, flag: "ca", continent: "North America" },
            { name: "Mexico City", lat: 19.4326, lon: -99.1332, offset: -5, flag: "mx", continent: "North America" },
            { name: "Sao Paulo", lat: -23.5505, lon: -46.6333, offset: -3, flag: "br", continent: "South America" },
            { name: "Buenos Aires", lat: -34.6037, lon: -58.3816, offset: -3, flag: "ar", continent: "South America" },
            { name: "Rio de Janeiro", lat: -22.9068, lon: -43.1729, offset: -3, flag: "br", continent: "South America" },
            { name: "Lima", lat: -12.0464, lon: -77.0428, offset: -5, flag: "pe", continent: "South America" },
            { name: "Bogota", lat: 4.7110, lon: -74.0721, offset: -5, flag: "co", continent: "South America" },
            { name: "Santiago", lat: -33.4489, lon: -70.6693, offset: -4, flag: "cl", continent: "South America" },
            { name: "Cape Town", lat: -33.9249, lon: 18.4241, offset: 2, flag: "za", continent: "Africa" },
            { name: "Nairobi", lat: -1.2921, lon: 36.8219, offset: 3, flag: "ke", continent: "Africa" },
            { name: "Lagos", lat: 6.5244, lon: 3.3792, offset: 1, flag: "ng", continent: "Africa" },
            { name: "Cairo", lat: 30.0444, lon: 31.2357, offset: 2, flag: "eg", continent: "Africa" },
            { name: "Johannesburg", lat: -26.2041, lon: 28.0473, offset: 2, flag: "za", continent: "Africa" },
            { name: "Accra", lat: 5.6037, lon: -0.1870, offset: 0, flag: "gh", continent: "Africa" },
            { name: "Melbourne", lat: -37.8136, lon: 144.9631, offset: 10, flag: "au", continent: "Oceania" },
            { name: "Auckland", lat: -36.8485, lon: 174.7633, offset: 12, flag: "nz", continent: "Oceania" },
            { name: "Perth", lat: -31.9505, lon: 115.8605, offset: 8, flag: "au", continent: "Oceania" },
            { name: "Brisbane", lat: -27.4698, lon: 153.0251, offset: 10, flag: "au", continent: "Oceania" },
            { name: "Honolulu", lat: 21.3069, lon: -157.8583, offset: -10, flag: "us", continent: "Oceania" }
        ];

        let weatherData = {};
        const CACHE_DURATION = 30 * 60 * 1000; // 30 minutes cache

        async function fetchWeatherChunk(citiesChunk, retries = 3) {
            const promises = citiesChunk.map(city => fetchWeather(city, retries));
            return await Promise.all(promises);
        }

        async function fetchWeather(city, retries = 3) {
            const cached = localStorage.getItem(`weather_${city.name}`);
            let cachedData = cached ? JSON.parse(cached) : null;
            if (cachedData && Date.now() - cachedData.timestamp < CACHE_DURATION) {
                return cachedData.data;
            }

            const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current_weather=true&hourly=relativehumidity_2m&timezone=auto`;
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    const weatherCode = data.current_weather.weathercode;
                    const weatherIcon = getWeatherIcon(weatherCode);
                    const weather = {
                        temperature: data.current_weather.temperature,
                        humidity: data.hourly.relativehumidity_2m[0],
                        weatherIcon: weatherIcon
                    };
                    localStorage.setItem(`weather_${city.name}`, JSON.stringify({
                        data: weather,
                        timestamp: Date.now()
                    }));
                    return weather;
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed for ${city.name}: ${error.message}, URL: ${url}`);
                    if (i === retries - 1) {
                        if (cachedData) {
                            console.warn(`Using expired cache for ${city.name}`);
                            return cachedData.data;
                        }
                        return { temperature: "N/A", humidity: "N/A", weatherIcon: "‚ùì" };
                    }
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
        }

        function getWeatherIcon(code) {
            if (code === 0) return "‚òÄÔ∏è";
            if (code <= 3) return "‚õÖ";
            if (code <= 67) return "üåßÔ∏è";
            if (code <= 77) return "‚ùÑÔ∏è";
            return "üå©Ô∏è";
        }

        async function initializeWeather() {
            const chunkSize = 10;
            for (let i = 0; i < cities.length; i += chunkSize) {
                const chunk = cities.slice(i, i + chunkSize);
                const results = await fetchWeatherChunk(chunk);
                chunk.forEach((city, index) => {
                    weatherData[city.name] = results[index];
                    const clock = clocks.find(c => c.city.name === city.name);
                    if (clock) {
                        updateClock(clock.clock, clock.city.offset, weatherData[city.name]);
                    }
                });
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        async function updateWeather() {
            const chunkSize = 10;
            for (let i = 0; i < cities.length; i += chunkSize) {
                const chunk = cities.slice(i, i + chunkSize);
                const results = await fetchWeatherChunk(chunk);
                chunk.forEach((city, index) => {
                    weatherData[city.name] = results[index];
                });
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        function createClock(city) {
            const container = document.getElementById("clocks-container");
            const clockDiv = document.createElement("div");
            clockDiv.className = "clock-container";
            clockDiv.dataset.continent = city.continent;
            clockDiv.innerHTML = `
                <div class="city-header">
                    <img class="flag-img" src="https://flagcdn.com/24x18/${city.flag}.png" alt="${city.flag}">
                    <div class="city-name">${city.name}</div>
                </div>
                <div class="digital-clock"></div>
                <div class="weather-info loading">Weather: Loading</div>
            `;
            container.appendChild(clockDiv);
            return clockDiv;
        }

        function createFilterButtons() {
            const continents = ["All", "Asia", "Europe", "N America", "S America", "Africa", "Oceania"];
            const container = document.getElementById("filter-buttons");
            continents.forEach(continent => {
                const btn = document.createElement("button");
                btn.className = "filter-btn";
                btn.textContent = continent;
                btn.dataset.continent = continent === "All" ? "" : continent.replace("N ", "North ").replace("S ", "South ");
                btn.addEventListener("click", () => {
                    document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
                    btn.classList.add("active");
                    filterClocks(continent === "All" ? "All" : continent.replace("N ", "North ").replace("S ", "South "));
                    setTransformOrigin();
                });
                container.appendChild(btn);
            });
            document.querySelector(".filter-btn").classList.add("active");
        }

        function filterClocks(continent) {
            const clocks = document.querySelectorAll(".clock-container");
            clocks.forEach(clock => {
                if (continent === "All") {
                    clock.style.display = "block";
                } else {
                    clock.style.display = clock.dataset.continent === continent ? "block" : "none";
                }
            });
        }

        function updateClock(clock, offset, weather) {
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const localTime = new Date(utc + (3600000 * offset));

            const hours = localTime.getHours();
            const minutes = localTime.getMinutes();
            const seconds = localTime.getSeconds();

            const displayHours = hours < 10 ? `0${hours}` : hours;
            const displayMinutes = minutes < 10 ? `0${minutes}` : minutes;
            const displaySeconds = seconds < 10 ? `0${seconds}` : seconds;
            clock.querySelector(".digital-clock").innerHTML = `${displayHours}:${displayMinutes}:<span class="seconds">${displaySeconds}</span>`;

            clock.querySelector(".weather-info").classList.remove("loading");
            clock.querySelector(".weather-info").innerHTML = weather.temperature !== "N/A" ?
                `Weather: <span class="weather-icon">${weather.weatherIcon}</span> <span class="temperature">${weather.temperature}¬∞C</span>, Humidity: <span class="humidity">${weather.humidity}%</span>` : "Weather: N/A";
        }

        function updateAll() {
            clocks.forEach(({ clock, city }) => {
                updateClock(clock, city.offset, weatherData[city.name] || { temperature: "N/A", humidity: "N/A", weatherIcon: "‚ùì" });
            });
        }

        function setTransformOrigin() {
            const clocks = document.querySelectorAll(".clock-container");
            const visibleClocks = Array.from(clocks).filter(clock => clock.style.display !== "none");

            visibleClocks.forEach((clock, visibleIndex) => {
                const rect = clock.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;

                let originX = "center";
                let originY = "center";

                const row = Math.floor(visibleIndex / 5) + 1;
                const col = (visibleIndex % 5) + 1;

                const isEdge = row === 1 || row === Math.ceil(visibleClocks.length / 5) || col === 1 || col === 5;

                if (!isEdge) {
                    clock.style.transformOrigin = "center center";
                } else {
                    if (rect.left < windowWidth * 0.15) {
                        originX = "left";
                    } else if (rect.right > windowWidth * 0.85) {
                        originX = "right";
                    }

                    if (rect.top < windowHeight * 0.15) {
                        originY = "top";
                    } else if (rect.bottom > windowHeight * 0.85) {
                        originY = "bottom";
                    }

                    clock.style.transformOrigin = `${originY} ${originX}`;
                }
            });
        }

        const clocks = cities.map(city => ({ clock: createClock(city), city }));

        createFilterButtons();

        updateAll();
        setInterval(updateAll, 1000);

        initializeWeather().then(() => {
            updateAll();
            setInterval(updateWeather, 30 * 60 * 1000);
        }).catch(error => {
            console.error("Failed to initialize weather:", error);
        });

        window.addEventListener("resize", setTransformOrigin);
        setTransformOrigin();

        document.querySelectorAll(".accordion-header").forEach(header => {
            header.addEventListener("click", () => {
                const content = header.nextElementSibling;
                const isOpen = header.classList.contains("active");

                document.querySelectorAll(".accordion-header").forEach(h => {
                    h.classList.remove("active");
                    h.nextElementSibling.style.maxHeight = null;
                    h.nextElementSibling.style.padding = "0 15px";
                });

                if (!isOpen) {
                    header.classList.add("active");
                    content.style.maxHeight = content.scrollHeight + "px";
                    content.style.padding = "15px";
                }
            });
        });
    </script>
</body>
</html>