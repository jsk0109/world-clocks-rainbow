<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Clocks</title>
    <style>
        nav {
            background: #000;
            padding: 0;
            height: auto;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
            margin-bottom: 60px;
        }
        nav ul {
            list-style: none;
            margin: 0;
            padding: 10px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        nav ul li {
            margin: 5px 15px;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            line-height: 30px;
            transition: color 0.3s ease;
        }
        nav ul li a:hover {
            color: #1e90ff;
        }

        #filter-buttons {
            text-align: center;
            margin-bottom: 60px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        .filter-btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .filter-btn[data-continent=""] { background: #D32F2F; color: white; } /* ALL - 빨강 */
        .filter-btn[data-continent="Asia"] { background: #F57C00; color: white; } /* Asia - 주황 */
        .filter-btn[data-continent="Europe"] { background: #FBC02D; color: white; } /* Europe - 노랑 */
        .filter-btn[data-continent="N America"] { background: #388E3C; color: white; } /* North America - 초록 */
        .filter-btn[data-continent="S America"] { background: #1976D2; color: white; } /* South America - 파랑 */
        .filter-btn[data-continent="Africa"] { background: #303F9F; color: white; } /* Africa - 남색 */
        .filter-btn[data-continent="Oceania"] { background: #7B1FA2; color: white; } /* Oceania - 보라 */
        .filter-btn.active { opacity: 1; }
        .filter-btn:not(.active) { opacity: 0.6; }
        .filter-btn:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        #clocks-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .clock-container {
            background: #fff;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.5s ease-in-out;
            position: relative;
            z-index: 1;
        }
        .clock-container:hover {
            transform: scale(1.5);
            z-index: 10;
        }
        .clock-container[data-continent="Asia"] .digital-clock { border-color: #F57C00; }
        .clock-container[data-continent="Europe"] .digital-clock { border-color: #FBC02D; }
        .clock-container[data-continent="North America"] .digital-clock { border-color: #388E3C; }
        .clock-container[data-continent="South America"] .digital-clock { border-color: #1976D2; }
        .clock-container[data-continent="Africa"] .digital-clock { border-color: #303F9F; }
        .clock-container[data-continent="Oceania"] .digital-clock { border-color: #7B1FA2; }
        .city-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 5px;
        }
        .flag-img {
            width: 24px;
            height: 18px;
            margin-bottom: 5px;
        }
        .city-name {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        .digital-clock {
            width: 100px;
            height: 50px;
            border: 4px solid;
            border-radius: 10px;
            background: #E6F0FA;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Courier New', Courier, monospace;
            font-size: 20px;
            font-weight: bold;
            color: #333;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.2), 0 0 5px rgba(255,255,255,0.5);
        }
        .digital-clock .seconds {
            font-size: 14px;
            vertical-align: super;
            color: #1E90FF;
        }
        .weather-info {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        .weather-info.loading::after {
            content: ".";
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0% { content: "."; }
            33% { content: ".."; }
            66% { content: "..."; }
            100% { content: "."; }
        }
        .weather-info span.weather-icon { font-size: 14px; margin-right: 2px; }
        .weather-info span.temperature { color: #e63946; font-weight: bold; }
        .weather-info span.humidity { color: #1e90ff; }

        @media (max-width: 600px) {
            #clocks-container { grid-template-columns: repeat(2, 1fr); }
            .digital-clock { width: 120px; height: 60px; font-size: 24px; }
            .digital-clock .seconds { font-size: 16px; }
            .flag-img { width: 28px; height: 21px; }
            .city-name { font-size: 18px; }
            .clock-container:hover {
                transform: scale(1.3);
            }
            #filter-buttons {
                justify-content: space-around;
            }
            .filter-btn {
                flex: 1 1 45%;
                max-width: 180px;
                padding: 16px 32px;
                margin: 10px;
                font-size: 22px;
            }
        }

        .faq-section {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .faq-section h2 {
            color: #1e90ff;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .accordion {
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .accordion-header {
            background: #f7f7f7;
            padding: 15px;
            cursor: pointer;
            font-weight: 500;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }
        .accordion-header:hover {
            background: #e0e0e0;
        }
        .accordion-header::after {
            content: '▼';
            font-size: 12px;
            transition: transform 0.3s ease;
        }
        .accordion-header.active::after {
            transform: rotate(180deg);
        }
        .accordion-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            background: #fff;
        }
        .accordion-content p {
            padding: 15px 0;
            margin: 0;
            color: #666;
            font-weight: 400;
        }
    </style>
</head>
<body>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="privacy-policy.html">Privacy Policy</a></li>
            <li><a href="contact.html">Contact Us</a></li>
            <li><a href="guides.html">Guides</a></li>
            <li><a href="converter.html">Time Zone Converter</a></li>
            <li><a href="blog.html">Blog</a></li>
        </ul>
    </nav>
    <div id="filter-buttons"></div>
    <div id="clocks-container"></div>
    <div class="faq-section">
        <h2>Frequently Asked Questions</h2>
        <div class="accordion">
            <div class="accordion-header">How accurate are the times displayed?</div>
            <div class="accordion-content">
                <p>The times displayed are based on your device's system clock and the respective time zone offsets. They should be accurate as long as your device's clock is set correctly.</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">Why is the weather information not showing for some cities?</div>
            <div class="accordion-content">
                <p>Weather information is fetched from an external API. If the API is down, rate-limited, or the city’s coordinates are incorrect, the weather data may not be available. We retry fetching the data multiple times before showing "N/A".</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">Can I add more cities to the list?</div>
            <div class="accordion-content">
                <p>Currently, the list of cities is predefined in the code. To add more cities, you would need to modify the JavaScript code by adding new city objects to the `cities` array with their respective coordinates, time offsets, and flags.</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">How often is the weather updated?</div>
            <div class="accordion-content">
                <p>Weather data is cached for 30 minutes to reduce API calls. After 30 minutes, the data is refreshed automatically when the page updates the clocks.</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">Why do some clocks overlap when I hover over them?</div>
            <div class="accordion-content">
                <p>When you hover over a clock, it scales up for better visibility. The `z-index` is adjusted to bring the hovered clock to the front, but if clocks are too close, they might still overlap slightly. This is a design choice to make the clocks more interactive.</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">What time zone standard is used for the clocks?</div>
            <div class="accordion-content">
                <p>The clocks use the standard time zone offsets for each city, without accounting for daylight saving time (DST). For more precise adjustments, you can use the Time Zone Converter page.</p>
            </div>
        </div>
        <div class="accordion">
            <div class="accordion-header">Can I customize the appearance of the clocks?</div>
            <div class="accordion-content">
                <p>Yes, you can customize the appearance by modifying the CSS styles in the code. For example, you can change the colors, sizes, or fonts of the clocks by editing the `.digital-clock` and `.clock-container` classes.</p>
            </div>
        </div>
    </div>
    <script>
        const cities = [
            { name: "New York", lat: 40.7128, lon: -74.0060, offset: -5, flag: "us", continent: "North America" },
            { name: "London", lat: 51.5074, lon: -0.1278, offset: 0, flag: "gb", continent: "Europe" },
            { name: "Tokyo", lat: 35.6762, lon: 139.6503, offset: 9, flag: "jp", continent: "Asia" },
            { name: "Paris", lat: 48.8566, lon: 2.3522, offset: 1, flag: "fr", continent: "Europe" },
            { name: "Los Angeles", lat: 34.0522, lon: -118.2437, offset: -8, flag: "us", continent: "North America" },
            { name: "Sydney", lat: -33.8688, lon: 151.2093, offset: 10, flag: "au", continent: "Oceania" },
            { name: "Seoul", lat: 37.5665, lon: 126.9780, offset: 9, flag: "kr", continent: "Asia" },
            { name: "Berlin", lat: 52.5200, lon: 13.4050, offset: 1, flag: "de", continent: "Europe" },
            { name: "Toronto", lat: 43.6532, lon: -79.3832, offset: -5, flag: "ca", continent: "North America" },
            { name: "Moscow", lat: 55.7558, lon: 37.6173, offset: 3, flag: "ru", continent: "Europe" },
            { name: "Beijing", lat: 39.9042, lon: 116.4074, offset: 8, flag: "cn", continent: "Asia" },
            { name: "Dubai", lat: 25.2048, lon: 55.2708, offset: 4, flag: "ae", continent: "Asia" },
            { name: "Singapore", lat: 1.3521, lon: 103.8198, offset: 8, flag: "sg", continent: "Asia" },
            { name: "Hong Kong", lat: 22.3193, lon: 114.1694, offset: 8, flag: "hk", continent: "Asia" },
            { name: "Bangkok", lat: 13.7563, lon: 100.5018, offset: 7, flag: "th", continent: "Asia" },
            { name: "Mumbai", lat: 19.0760, lon: 72.8777, offset: 5.5, flag: "in", continent: "Asia" },
            { name: "Delhi", lat: 28.7041, lon: 77.1025, offset: 5.5, flag: "in", continent: "Asia" },
            { name: "Jakarta", lat: -6.2088, lon: 106.8456, offset: 7, flag: "id", continent: "Asia" },
            { name: "Manila", lat: 14.5995, lon: 120.9842, offset: 8, flag: "ph", continent: "Asia" },
            { name: "Kuala Lumpur", lat: 3.1390, lon: 101.6869, offset: 8, flag: "my", continent: "Asia" },
            { name: "Istanbul", lat: 41.0082, lon: 28.9784, offset: 3, flag: "tr", continent: "Europe" },
            { name: "Madrid", lat: 40.4168, lon: -3.7038, offset: 1, flag: "es", continent: "Europe" },
            { name: "Rome", lat: 41.9028, lon: 12.4964, offset: 1, flag: "it", continent: "Europe" },
            { name: "Amsterdam", lat: 52.3676, lon: 4.9041, offset: 1, flag: "nl", continent: "Europe" },
            { name: "Vienna", lat: 48.2082, lon: 16.3738, offset: 1, flag: "at", continent: "Europe" },
            { name: "Stockholm", lat: 59.3293, lon: 18.0686, offset: 1, flag: "se", continent: "Europe" },
            { name: "Oslo", lat: 59.9139, lon: 10.7522, offset: 1, flag: "no", continent: "Europe" },
            { name: "Helsinki", lat: 60.1699, lon: 24.9384, offset: 2, flag: "fi", continent: "Europe" },
            { name: "Copenhagen", lat: 55.6761, lon: 12.5683, offset: 1, flag: "dk", continent: "Europe" },
            { name: "Chicago", lat: 41.8781, lon: -87.6298, offset: -6, flag: "us", continent: "North America" },
            { name: "Miami", lat: 25.7617, lon: -80.1918, offset: -5, flag: "us", continent: "North America" },
            { name: "Vancouver", lat: 49.2827, lon: -123.1207, offset: -8, flag: "ca", continent: "North America" },
            { name: "Mexico City", lat: 19.4326, lon: -99.1332, offset: -6, flag: "mx", continent: "North America" },
            { name: "Sao Paulo", lat: -23.5505, lon: -46.6333, offset: -3, flag: "br", continent: "South America" },
            { name: "Buenos Aires", lat: -34.6037, lon: -58.3816, offset: -3, flag: "ar", continent: "South America" },
            { name: "Rio de Janeiro", lat: -22.9068, lon: -43.1729, offset: -3, flag: "br", continent: "South America" },
            { name: "Lima", lat: -12.0464, lon: -77.0428, offset: -5, flag: "pe", continent: "South America" },
            { name: "Bogota", lat: 4.7110, lon: -74.0721, offset: -5, flag: "co", continent: "South America" },
            { name: "Santiago", lat: -33.4489, lon: -70.6693, offset: -4, flag: "cl", continent: "South America" },
            { name: "Cape Town", lat: -33.9249, lon: 18.4241, offset: 2, flag: "za", continent: "Africa" },
            { name: "Nairobi", lat: -1.2921, lon: 36.8219, offset: 3, flag: "ke", continent: "Africa" },
            { name: "Lagos", lat: 6.5244, lon: 3.3792, offset: 1, flag: "ng", continent: "Africa" },
            { name: "Cairo", lat: 30.0444, lon: 31.2357, offset: 2, flag: "eg", continent: "Africa" },
            { name: "Johannesburg", lat: -26.2041, lon: 28.0473, offset: 2, flag: "za", continent: "Africa" },
            { name: "Accra", lat: 5.6037, lon: -0.1870, offset: 0, flag: "gh", continent: "Africa" },
            { name: "Melbourne", lat: -37.8136, lon: 144.9631, offset: 10, flag: "au", continent: "Oceania" },
            { name: "Auckland", lat: -36.8485, lon: 174.7633, offset: 12, flag: "nz", continent: "Oceania" },
            { name: "Perth", lat: -31.9505, lon: 115.8605, offset: 8, flag: "au", continent: "Oceania" },
            { name: "Brisbane", lat: -27.4698, lon: 153.0251, offset: 10, flag: "au", continent: "Oceania" },
            { name: "Honolulu", lat: 21.3069, lon: -157.8583, offset: -10, flag: "us", continent: "Oceania" }
        ];

        let weatherData = {};
        const CACHE_DURATION = 30 * 60 * 1000; // 30분 캐시

        async function fetchWeatherChunk(citiesChunk, retries = 3) {
            const promises = citiesChunk.map(city => fetchWeather(city, retries));
            return await Promise.all(promises);
        }

        async function fetchWeather(city, retries = 3) {
            const cached = localStorage.getItem(`weather_${city.name}`);
            let cachedData = cached ? JSON.parse(cached) : null;
            if (cachedData && Date.now() - cachedData.timestamp < CACHE_DURATION) {
                return cachedData.data;
            }

            const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}¤t_weather=true&hourly=relativehumidity_2m&timezone=auto`;
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    const weatherCode = data.current_weather.weathercode;
                    const weatherIcon = getWeatherIcon(weatherCode);
                    const weather = {
                        temperature: data.current_weather.temperature,
                        humidity: data.hourly.relativehumidity_2m[0],
                        weatherIcon: weatherIcon
                    };
                    localStorage.setItem(`weather_${city.name}`, JSON.stringify({
                        data: weather,
                        timestamp: Date.now()
                    }));
                    return weather;
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed for ${city.name}: ${error.message}, URL: ${url}`);
                    if (i === retries - 1) {
                        if (cachedData) {
                            console.warn(`Using expired cache for ${city.name}`);
                            return cachedData.data;
                        }
                        return { temperature: "N/A", humidity: "N/A", weatherIcon: "❓" };
                    }
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
        }

        function getWeatherIcon(code) {
            if (code === 0) return "☀️";
            if (code <= 3) return "⛅";
            if (code <= 67) return "🌧️";
            if (code <= 77) return "❄️";
            return "🌩️";
        }

        async function initializeWeather() {
            const chunkSize = 10;
            for (let i = 0; i < cities.length; i += chunkSize) {
                const chunk = cities.slice(i, i + chunkSize);
                const results = await fetchWeatherChunk(chunk);
                chunk.forEach((city, index) => {
                    weatherData[city.name] = results[index];
                    const clock = clocks.find(c => c.city.name === city.name);
                    if (clock) {
                        updateClock(clock.clock, clock.city.offset, weatherData[city.name]);
                    }
                });
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        async function updateWeather() {
            const chunkSize = 10;
            for (let i = 0; i < cities.length; i += chunkSize) {
                const chunk = cities.slice(i, i + chunkSize);
                const results = await fetchWeatherChunk(chunk);
                chunk.forEach((city, index) => {
                    weatherData[city.name] = results[index];
                });
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        function createClock(city) {
            const container = document.getElementById("clocks-container");
            const clockDiv = document.createElement("div");
            clockDiv.className = "clock-container";
            clockDiv.dataset.continent = city.continent;
            clockDiv.innerHTML = `
                <div class="city-header">
                    <img class="flag-img" src="https://flagcdn.com/24x18/${city.flag}.png" alt="${city.flag}">
                    <div class="city-name">${city.name}</div>
                </div>
                <div class="digital-clock"></div>
                <div class="weather-info loading">Weather: Loading</div>
            `;
            container.appendChild(clockDiv);
            return clockDiv;
        }

        function createFilterButtons() {
            const continents = ["All", "Asia", "Europe", "N America", "S America", "Africa", "Oceania"];
            const container = document.getElementById("filter-buttons");
            continents.forEach(continent => {
                const btn = document.createElement("button");
                btn.className = "filter-btn";
                btn.textContent = continent;
                btn.dataset.continent = continent === "All" ? "" : continent.replace("N ", "North ").replace("S ", "South ");
                btn.addEventListener("click", () => {
                    document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
                    btn.classList.add("active");
                    filterClocks(continent === "All" ? "All" : continent.replace("N ", "North ").replace("S ", "South "));
                    setTransformOrigin();
                });
                container.appendChild(btn);
            });
            document.querySelector(".filter-btn").classList.add("active");
        }

        function filterClocks(continent) {
            const clocks = document.querySelectorAll(".clock-container");
            clocks.forEach(clock => {
                if (continent === "All") {
                    clock.style.display = "block";
                } else {
                    clock.style.display = clock.dataset.continent === continent ? "block" : "none";
                }
            });
        }

        function updateClock(clock, offset, weather) {
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const localTime = new Date(utc + (3600000 * offset));

            const hours = localTime.getHours();
            const minutes = localTime.getMinutes();
            const seconds = localTime.getSeconds();

            const displayHours = hours < 10 ? `0${hours}` : hours;
            const displayMinutes = minutes < 10 ? `0${minutes}` : minutes;
            const displaySeconds = seconds < 10 ? `0${seconds}` : seconds;
            clock.querySelector(".digital-clock").innerHTML = `${displayHours}:${displayMinutes}:<span class="seconds">${displaySeconds}</span>`;

            clock.querySelector(".weather-info").classList.remove("loading");
            clock.querySelector(".weather-info").innerHTML = weather.temperature !== "N/A" ?
                `Weather: <span class="weather-icon">${weather.weatherIcon}</span> <span class="temperature">${weather.temperature}°C</span>, Humidity: <span class="humidity">${weather.humidity}%</span>` : "Weather: N/A";
        }

        function updateAll() {
            clocks.forEach(({ clock, city }) => {
                updateClock(clock, city.offset, weatherData[city.name] || { temperature: "N/A", humidity: "N/A", weatherIcon: "❓" });
            });
        }

        function setTransformOrigin() {
            const clocks = document.querySelectorAll(".clock-container");
            const visibleClocks = Array.from(clocks).filter(clock => clock.style.display !== "none");

            visibleClocks.forEach((clock, visibleIndex) => {
                const rect = clock.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;

                let originX = "center";
                let originY = "center";

                const row = Math.floor(visibleIndex / 5) + 1;
                const col = (visibleIndex % 5) + 1;

                const isEdge = row === 1 || row === Math.ceil(visibleClocks.length / 5) || col === 1 || col === 5;

                if (!isEdge) {
                    clock.style.transformOrigin = "center center";
                } else {
                    if (rect.left < windowWidth * 0.15) {
                        originX = "left";
                    } else if (rect.right > windowWidth * 0.85) {
                        originX = "right";
                    }

                    if (rect.top < windowHeight * 0.15) {
                        originY = "top";
                    } else if (rect.bottom > windowHeight * 0.85) {
                        originY = "bottom";
                    }

                    clock.style.transformOrigin = `${originY} ${originX}`;
                }
            });
        }

        const clocks = cities.map(city => ({ clock: createClock(city), city }));

        createFilterButtons();

        updateAll();
        setInterval(updateAll, 1000);

        initializeWeather().then(() => {
            updateAll();
            setInterval(updateWeather, 10 * 60 * 1000);
        }).catch(error => {
            console.error("Failed to initialize weather:", error);
        });

        window.addEventListener("resize", setTransformOrigin);
        setTransformOrigin();

        document.querySelectorAll(".accordion-header").forEach(header => {
            header.addEventListener("click", () => {
                const content = header.nextElementSibling;
                const isOpen = header.classList.contains("active");

                document.querySelectorAll(".accordion-header").forEach(h => {
                    h.classList.remove("active");
                    h.nextElementSibling.style.maxHeight = null;
                    h.nextElementSibling.style.padding = "0 15px";
                });

                if (!isOpen) {
                    header.classList.add("active");
                    content.style.maxHeight = content.scrollHeight + "px";
                    content.style.padding = "15px 15px";
                }
            });
        });
    </script>
</body>
</html>
